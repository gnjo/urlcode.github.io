
<body>
 <script type="text/javascript">
function tokenp(response){
  var meta = response.meta;
  var data = response.data;
  console.log("tokenp",meta);
  console.log("tokenp",data);
 //access_token=<アクセストークン>&scope=&token_type=bearer
}

window.addEventListener('DOMContentLoaded',()=>{
});
//code
//client_id,
 </script> 
 <script src="//urlcode.github.io/useful.js"></script>
 <script src="//urlcode.github.io/usefuldom.js"></script> 
 <script type="text/javascript" id="jsonp">
function foo(response) {
  var meta = response.meta;
  var data = response.data;
  var cep="\n";
  var show=function(obj){return Object.keys(obj).map((d)=>{ return d+': '+obj[d] }).join(cep)}
  get('result').textContent +=''+show(meta)+cep+show(data);
  //console.log("foo",meta);
  //console.log("foo",data);
}
</script>
<script type="text/javascript">
function foo2(response) {
  var meta = response.meta;
  var data = response.data;
  //console.log("foo2",meta);
  //console.log("foo2",data);
} 
</script>
<script>



window.addEventListener('load',()=>{
 //
  
 //
var j=get('jsonp');
var script = document.createElement('script');
 on(script,'load',()=>{
  //console.log('in'); 
 });
 j.appendChild(script);
 var url='',cb='callback=foo2';
  url='https://api.github.comllll';
  url='https://api.github.com/user';
 var oauth="00e5aac76b7ca8be21adf8002d81e6e18f6db3f5";
  url='https://api.github.com/?access_token='+oauth;
  url='https://api.github.com/v3/repos/contents';
 //
 var at=(url.indexOf('?')==-1)?'?':'&';
 //console.log(url+ at + cb)
 script.src = url+ at + cb;
 //
 
 var c_id='9b648ffa569035ebdfe7';
 var authurl='https://github.com/login/oauth/authorize?client_id='+c_id+'&scope=repo';
 //
 //https://github.com/login/oauth/authorize?client_id=$CLIENT_ID&scope=repo
 //9b648ffa569035ebdfe7
//https://urlcode.github.io/authdemo.html?callback=foo 
 //
 
 var auth=get("authbtn");
 on(auth,'click',()=>{
  //console.log("authbtn hit")
  var script = document.createElement('script');
  on(script,'load',()=>{
    //console.log('load',location); 
  });  
   script.src = "https://github.com/login/oauth/authorize?client_id=9b648ffa569035ebdfe7&scope=repo";
 });
 
}); 
 
 ///
  var authredirect=function authredirect(){
   var code=location.search.split(/\?|\&/)
    .filter((d)=>{return ( d.split('=')[0]==='code') ? true : false });
    
   console.log(location,code);
   //https://urlcode.github.io/authdemo.html?callback=foo&code=6c3e5c0a087b02244e8f
   return (code.length==0)?null:code[0].split('=')[1];
  };
 var getaccesstoken=function getaccesstoken(code){
   console.log('redirect',code);
   var client_secret ='ca03b9287ab83de30abeca3670b481da51e031fa',client_id='9b648ffa569035ebdfe7';
   var authurl='https://github.com/login/oauth/access_token'+'?callback=foo'+
       '&code='+code+'&client_id='+client_id+'&client_secret='+client_secret;
   var el = document.createElement('script');
   //
   on(el,'load',function(){  console.log('load',authurl) }
   document.body.appendChild(el);
   //el.type="application/x-www-form-urlencoded";
   el.src=authurl;
 };
  var c=authredirect();
  if(c) getaccesstoken(c);
  else console.log('normal')
 
 /// 
 
</script>
 
 <style>#result{position:fixed; top:0;right:0;padding:1em;background-color:rgba(0,0,0,0.75);color:white;max-height:300px;overflow-y:scroll}</style>
 <pre id="result"></pre>
 <a href="https://github.com/login/oauth/authorize?client_id=9b648ffa569035ebdfe7&scope=repo">redirect auth</a>
 <button id="authbtn">auth</button>
<!-- <script src="https://gist.github.com/craveytrain/735512.js"></script>-->
</body>
